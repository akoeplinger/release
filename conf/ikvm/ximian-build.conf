<?xml version="1.0" ?>

<!DOCTYPE module SYSTEM "helix-build.dtd">

<module>
  <targetset>
    <filter>
      <i>.*</i>
    </filter>
    <name>ikvm</name>

    <epoch>1</epoch>

    <psdata id="copyright">BSD</psdata>
    <psdata id="url">http://www.ikvm.net</psdata>

    <source>
      <!-- doesn't really work, just fools buildbuddy about where the tar is -->
      <i>SVN svn+ssh://mono-cvs.ximain.com/source/trunk</i>
    </source>

    <build id="default">
      <prepare>true</prepare>
      <compile>true</compile>
      <install>
<![CDATA[

# Create dirs
mkdir -p ${DESTDIR}[[usrprefix]]/bin
mkdir -p ${DESTDIR}[[usrprefix]]/lib/ikvm
mkdir -p ${DESTDIR}[[usrprefix]]/lib/pkgconfig

#Install binaries
find bin . -name "*\.dll" -exec cp {} ${DESTDIR}[[usrprefix]]/lib/ikvm  \;
find bin . -name "*\.exe" -exec cp {} ${DESTDIR}[[usrprefix]]/lib/ikvm  \;

# Generate wrapper scripts
for f in `find bin . -name "*\.exe"` ; do
	script_name=${DESTDIR}[[usrprefix]]/bin/`basename $f .exe`
	cat <<EOF > $script_name
#!/bin/sh
exec `which mono` [[usrprefix]]/lib/ikvm/`basename $f` "\$@"
EOF

	chmod 755 $script_name

done


# Generate .pc file
cat <<EOF > ${DESTDIR}[[usrprefix]]/lib/pkgconfig/ikvm.pc
prefix=[[usrprefix]]
exec_prefix=\${prefix}
libdir=\${prefix}/lib

Name: IKVM.NET
Description: An implementation of Java for Mono and the Microsoft .NET Framework.
Version: [[version]]
Libs: -r:\${libdir}/ikvm/IKVM.Runtime.dll -r:\${libdir}/ikvm/IKVM.GNU.Classpath.dll

EOF

]]>
      </install>

      <psdata id="buildarch">noarch</psdata>

      <package id="default">
        <name>ikvm</name>

        <psdata id="group">Development/Tools</psdata>

        <files>
          <i>[[usrprefix]]/bin/*</i>
          <i>[[usrprefix]]/lib/ikvm</i>
          <i>[[usrprefix]]/lib/pkgconfig/ikvm.pc</i>
        </files>

        <docs>
          <i>LICENSE</i>
        </docs>

        <dep id="requires">
          <i>mono-ikvm</i>
        </dep>

<script id="find_provides">
           <i>
<![CDATA[
#!/bin/sh

filelist=`sed "s/['\"]/\\\&/g"`
 
{
    echo $filelist | tr [:blank:] \\n | /usr/lib/rpm/find-provides
    echo $filelist | tr [:blank:] \\n | /usr/bin/mono-find-provides
} | sort | uniq

]]>
           </i>
</script> 

<script id="find_requires">
           <i>
<![CDATA[
#!/bin/sh

filelist=`sed "s/['\"]/\\\&/g"`
 
{
    echo $filelist | tr [:blank:] \\n | /usr/lib/rpm/find-requires
    echo $filelist | tr [:blank:] \\n | /usr/bin/mono-find-requires
} | sort | uniq
]]>
           </i>           
</script>
        
        <description>
          <h>A JVM based on the Mono runtime</h>
          <p>
	    This package provides IKVM.NET, an open source Java
	    compatibility layer for Mono, which includes a Virtual
	    Machine, a bytecode compiler, and various class libraries
	    for Java, as well as tools for Java and Mono
	    interoperability.
	  </p>
        </description>
      </package>
    </build>
  </targetset>
</module>

<!--
    Local Variables:
    mode: xml
    End:
  -->
