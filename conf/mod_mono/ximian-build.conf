<?xml version="1.0" ?>

<!DOCTYPE module SYSTEM "helix-build.dtd">

<module>
	<decl>
		<macro id="apache">httpd</macro>
		<macro id="apachesysconfdir">[[usrsysconfdir]]/httpd/conf.d</macro>
		<macro id="apachelibdir">[[usrlibdir]]/httpd/modules</macro>
	</decl>

  <targetset>
    <filter>
      <i>.*</i>
    </filter>
    <name>mod_mono</name>

    <psdata id="copyright">GPL</psdata>
    <psdata id="url">http://www.apacheworld.org/modmono</psdata>

    <source>
      <!-- doesn't really work, just fools buildbuddy about where the tar is -->
      <i>SVN svn+ssh://mono-cvs.ximain.com/source/trunk</i>
    </source>
    
    <build id="default">
      <prepare>[[prepend_prepare]][[usrconfigure]]</prepare>
      <compile>${MAKE}</compile>
      <install>${MAKE} DESTDIR=${DESTDIR} install APXS_SYSCONFDIR="[[apachesysconfdir]]"</install>

      <builddep id="buildrequires">
        <i>mono-devel</i>
        <i>xsp</i>
        <i>pkgconfig</i>
        <i>[[apache]]-devel</i>
      </builddep>

      <package id="default">
        <name>mod_mono</name>

        <psdata id="group">System Environment/Daemons</psdata>

        <files>
          <i>[[apachelibdir]]/mod_mono.so*</i>
	  <i>%config [[apachesysconfdir]]/mod_mono.conf</i>
          <i>[[usrmandir]]/man8/mod_mono.8</i>
        </files>

        <docs />
        
        <dep id="requires">
          <i>[[apache]]</i>
	  <!-- require a version on breaking changes -->
	  <!-- <i>xsp = [[version]]</i> -->
	  <i>xsp</i>
        </dep>

        <description>
          <h>A module to deploy an ASP.NET application on Apache with Mono</h>
          <p>
	    This package provides mod_mono, a package that allows Apache to
	    serve ASP.NET pages by proxying the requests to a slightly
	    modified version of our XSP server, called mod-mono-server, that
	    is installed along with XSP.
	  </p>
        </description>
      </package>
    </build>
  </targetset>
	
	<targetset>
		<filter>
			<i>suse*</i>
			<i>sles*</i>
			<i>nld*</i>
		</filter>
		<decl>
			<macro id="apache">apache2</macro>
			<macro id="apachesysconfdir">[[usrsysconfdir]]/apache2/conf.d</macro>
			<macro id="apachelibdir">[[usrlibdir]]/apache2</macro>
		</decl>
	</targetset>

  <targetset>
    <filter>
      <i>suse-101-</i>
    </filter>
    <!-- Since we create the source tarball on suse 9.3, this is needed to build on 10.1 -->
    <decl>
      <macro id="prepend_prepare">export CPPFLAGS="-I/usr/include/apr-1";  autoreconf -fi;</macro>
    </decl>
  </targetset>
</module>


<!--
    Local Variables:
    mode: xml
    End:
  -->
