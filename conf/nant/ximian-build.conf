<?xml version="1.0" ?>

<!DOCTYPE module SYSTEM "helix-build.dtd">

<module>
  <targetset>
    <filter>
      <i>.*</i>
    </filter>
    <name>nant</name>

    <psdata id="copyright">GPL</psdata>
    <psdata id="url">http://nant.sourceforge.net</psdata>

    <source>
      <i>SVN https://svn.sourceforge.net/svnroot/nant</i>
    </source>

    <build id="default">
      <!-- fix for 64 bit -->
      <prepare>sed -i "s/sr.ReadLine()/sr.ReadLine().Replace(\"\\\x00\", \"\")/" src/NAnt.Core/Functions/PkgConfigFunctions.cs</prepare>
      <compile>${MAKE}</compile>
      <install><![CDATA[
make install prefix=${DESTDIR}[[usrprefix]]

cd ${DESTDIR}

# .NET libs
rm -Rf .[[usrprefix]]/share/NAnt/bin/lib/net

# Put mono libs in the gac
find .[[usrprefix]]/share/NAnt/bin/lib/mono -name "*\.dll" -exec gacutil -root ${RPM_BUILD_ROOT}[[usrprefix]]/lib -i {} \;

# These are in the gac now, remove them
rm -Rf .[[usrprefix]]/share/NAnt/bin/lib/mono

# Rearrange things according to app guidelines
mkdir -p .[[usrprefix]]/lib
mv .[[usrprefix]]/share/NAnt/bin .[[usrprefix]]/lib/NAnt
mv .[[usrprefix]]/lib/NAnt/lib/*.dll .[[usrprefix]]/lib/NAnt
rmdir .[[usrprefix]]/lib/NAnt/lib

# Cleanup cruft
rm -Rf .[[usrprefix]]/share

# Fix script
cat <<EOF > .[[usrprefix]]/bin/nant
#!/bin/sh
`pkg-config mono --variable prefix`/bin/mono [[usrprefix]]/lib/NAnt/NAnt.exe "\$@"
EOF
chmod 755 .[[usrprefix]]/bin/nant
]]>

      </install>
      
      <psdata id="buildarch">noarch</psdata>

      <builddep id="buildrequires">
        <i>mono-devel</i>
        <i>mono-data</i>
      </builddep>
      
      <package id="default">
        <name>nant</name>

        <psdata id="group">Development</psdata>

        <files>
		<i>[[usrprefix]]/bin/nant</i>
		<i>[[usrprefix]]/lib/NAnt</i>

		<i>[[usrprefix]]/lib/mono/gac/NDoc.Core</i>
		<i>[[usrprefix]]/lib/mono/gac/NDoc.Documenter.Msdn</i>
		<i>[[usrprefix]]/lib/mono/gac/NDoc.ExtendedUI</i>
		<i>[[usrprefix]]/lib/mono/gac/nunit.core</i>
		<i>[[usrprefix]]/lib/mono/gac/nunit.framework</i>
		<i>[[usrprefix]]/lib/mono/gac/nunit.util</i>
        </files>

        <docs />

<script id="find_provides">
           <i>
<![CDATA[
#!/bin/sh

filelist=`sed "s/['\"]/\\\&/g"`
 
{
    echo $filelist | tr [:blank:] \\n | /usr/lib/rpm/find-provides
    echo $filelist | tr [:blank:] \\n | /usr/bin/mono-find-provides
} | sort | uniq

]]>
           </i>
</script> 

<script id="find_requires">
           <i>
<![CDATA[
#!/bin/sh

filelist=`sed "s/['\"]/\\\&/g"`
 
{
    echo $filelist | tr [:blank:] \\n | /usr/lib/rpm/find-requires
    echo $filelist | tr [:blank:] \\n | /usr/bin/mono-find-requires
} | sort | uniq
]]>
           </i>           
</script>

        <description>
          <h>Ant for .NET</h>
          <p>NAnt is a free .NET build tool. In theory it is kind of like make without make's wrinkles. In practice it's a lot like Ant.</p>
        </description>
      </package>
    </build>
  </targetset>
</module>


<!--
    Local Variables:
    mode: xml
    End:
  -->
