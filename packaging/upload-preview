#!/bin/sh

BUNDLE="PRE-RELEASE"
STAGE_DIR="$(pwd)/stage/preview"

TARGET_USER="mono-web"
TARGET_HOST="mono.ximian.com"
TARGET_DIR="~/release/monobuild/www"
TARGET_URL="/monobuild/preview"

mkdir -p $STAGE_DIR

# Build up stage
cd ../website
cp packaging.css $STAGE_DIR

./sync-bundle.py $BUNDLE $STAGE_DIR || exit 1

./mk-sources-index.py           $BUNDLE $STAGE_DIR $TARGET_URL $STAGE_DIR/sources			|| exit 1
./mk-distro-index.py --skip_zip $BUNDLE $STAGE_DIR $TARGET_URL $STAGE_DIR/packages $TARGET_HOST		|| exit 1
./mk-archive-index.py           $BUNDLE $STAGE_DIR $TARGET_URL						|| exit 1
./mk-repos.py                   $BUNDLE $STAGE_DIR $TARGET_URL $STAGE_DIR/packages $TARGET_HOST		|| exit 1

# Publish stage
ssh $TARGET_USER@$TARGET_HOST "mkdir -p $TARGET_DIR"
rsync -avzH --delete $STAGE_DIR $TARGET_USER@$TARGET_HOST:$TARGET_DIR
