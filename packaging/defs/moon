web_index=8

MKTARBALL_HEAD_DEPS=1

BUILD_HOSTS=(
        suse-101-i586
        suse-101-x86_64
)

USE_HOSTS=(${BUILD_HOSTS[@]})

MONO_DEPS=(
	mono
	olive
	monodoc
)

MONO_RECOMMEND_DEPS=(
	gtk-sharp2
	gtk-sharp28
	gtk-sharp210
	gnome-sharp2
	libgdiplus
)

get_destroot () {
	DEST_ROOT=$DISTRO
}

HEAD_PATH=(
        trunk/moon
)
RELEASE_PATH=(
        tags/mono-[[version]]/moon
)

update_version_file () {
        sed -i "s/\(AM_INIT_AUTOMAKE.*,\\).*)/\\1$VERSION)/" configure.ac
}

# This jail has ffmpeg in it
MKTARBALL_HOST="suse-101-i586"

POSTBUILD_STEP_NAME1="plugin-1.0"
POSTBUILD_STEP1 () {
	curl -s http://go-mono.com/moon/moon-ffmpeg.tar.bz2 | tar xj
	pushd moon-ffmpeg
	./configure --enable-gpl --disable-muxers --disable-encoders #--disable-demuxers --disable-parsers --disable-bsfs --disable-protocols --disable-decoders --enable-decoder=wmv1 --enable-decoder=wmv2 --enable-decoder=wmv3 --enable-decoder=vc1 --enable-decoder=wmva1 --enable-decoder=wmva2 --enable-decoder=mp3
	make
	popd

	make distclean
	export PKG_CONFIG_PATH=$(pwd)/moon-ffmpeg:$PKG_CONFIG_PATH
	./configure --without-mono-runtime --enable-user-plugin
	make
	target=$build_location/steps/plugin-1.0
	mkdir -p $target
	cp plugin/novell-moonlight*.xpi $target/
}

POSTBUILD_STEP_NAME2="plugin-1.1"
POSTBUILD_STEP2 () {
	make distclean
	export PKG_CONFIG_PATH=$(pwd)/moon-ffmpeg:$PKG_CONFIG_PATH
	./configure --enable-user-plugin
	make
	target=$build_location/steps/plugin-1.1
	mkdir -p $target
	cp plugin/novell-moonlight*.xpi $target/
}
