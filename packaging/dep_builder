#!/usr/bin/env python

import sys

import pdb

sys.path+=['../pyutils']

import packaging

if len(sys.argv) < 4:
        print "Usage: dep_builder <jail> <dep_def filename> <release>"
        sys.exit(1)

jail = sys.argv[1]
def_filename = sys.argv[2]
release = sys.argv[3]

env = packaging.buildenv(jail)

build_location = env.env_vars['build_location']

#pdb.set_trace()

env.ssh.copy_to(['do-dep-build', 'dep_defs/' + def_filename, '../pyutils/*.py', 'do-install-zip-pkgs', '../pyutils/rpm2cpio.py', 'conf/' + jail], build_location)

code, output = env.ssh.execute('%s/do-dep-build %s %s %s %s' % (build_location, jail, def_filename, release, build_location) )

if code:
	print "Error building deps..."
	sys.exit(1)

# Copy files back
env.ssh.copy_from(build_location + '/builder/built-packages/*', 'external_zip_pkg')


